<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Ressource bearbeiten</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f5f7fa; }
    .form-group { margin-bottom: 16px; }
    label { display: block; margin-bottom: 6px; font-weight: 600; }
    input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
    textarea { min-height: 100px; resize: vertical; }
    button { padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer; margin-right: 10px; }
    button[type="submit"] { background: #6b46c1; color: white; }
    button[type="button"] { background: #95a5a6; color: white; }
  </style>
</head>
<body>
  <h2>Ressource bearbeiten</h2>
  <form id="editForm">
    <input type="hidden" id="editIndex">
    <div class="form-group">
      <label>Thema *</label>
      <input type="text" id="topic" required>
    </div>
    <div class="form-group">
      <label>Fach</label>
      <select id="subject">
        <option>Deutsch</option><option>Mathematik</option><option>Englisch</option>
        <option>Biologie</option><option>Chemie</option><option>Physik</option>
        <option>Geschichte</option><option>Geografie</option><option>Politik</option>
        <option>Wirtschaft</option><option>Informatik</option><option>Kunst</option>
        <option>Musik</option><option>Sport</option><option>Ethik</option><option>Religion</option>
      </select>
    </div>
    <div class="form-group">
      <label>Klasse</label>
      <select id="grade">
        <option>Klasse 5</option><option>Klasse 6</option><option>Klasse 7</option>
        <option>Klasse 8</option><option>Klasse 9</option><option>Klasse 10</option>
        <option>Klasse 11</option><option>Klasse 12</option><option>Klasse 13</option>
      </select>
    </div>
    <div class="form-group">
      <label>Kompetenz</label>
      <select id="competence">
        <option>Suchen, Verarbeiten und Aufbewahren</option>
        <option>Kommunizieren und Kooperieren</option>
        <option>Produzieren und Präsentieren</option>
        <option>Schützen und sicher Agieren</option>
        <option>Problemlösen und Handeln</option>
        <option>Analysieren und Reflektieren</option>
      </select>
    </div>
    <div class="form-group">
      <label>Niveaustufe</label>
      <select id="level">
        <option>Niveaustufe 1</option><option>Niveaustufe 2</option><option>Niveaustufe 3</option>
        <option>Niveaustufe 4</option><option>Niveaustufe 5</option>
      </select>
    </div>
    <div class="form-group">
      <label>Tool</label>
      <input type="text" id="tool">
    </div>
    <div class="form-group">
      <label>Beschreibung</label>
      <textarea id="description"></textarea>
    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
      <button type="button" onclick="window.close()" style="background: #95a5a6; color: white;">Abbrechen</button>
      <button type="submit" style="background: #6b46c1; color: white;">Speichern</button>
    </div>
  </form>

  <script>
    // === Lese URL-Parameter ===
    const params = new URLSearchParams(window.location.search);
    const urlIndex = params.get('index');
    const rawData = params.get('data');

    let urlData = {};
    if (rawData) {
        try {
            urlData = JSON.parse(decodeURIComponent(rawData));
        } catch (e) {
            console.error("Datenfehler:", e);
        }
    }

    // === Formular befüllen ===
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('editIndex').value = urlIndex || '';
        document.getElementById('topic').value = urlData.topic || '';
        document.getElementById('subject').value = urlData.subject || '';
        document.getElementById('grade').value = urlData.grade || '';
        document.getElementById('competence').value = urlData.competence || '';
        document.getElementById('level').value = urlData.level || '';
        document.getElementById('tool').value = urlData.tool || '';
        document.getElementById('description').value = urlData.description || '';
    });

    // === Speichern ===
    document.getElementById('editForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const updated = {
            topic: document.getElementById('topic').value.trim(),
            subject: document.getElementById('subject').value,
            grade: document.getElementById('grade').value,
            competence: document.getElementById('competence').value,
            level: document.getElementById('level').value,
            tool: document.getElementById('tool').value.trim(),
            description: document.getElementById('description').value.trim(),
        };

        if (window.opener) {
            window.opener.postMessage({
                type: 'UPDATE_RESOURCE',
                index: parseInt(urlIndex),
                data: updated
            }, '*');
        }
        window.close();
    });
  </script>
</body>
</html>